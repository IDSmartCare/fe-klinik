(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5664],{2480:function(){},867:function(e,t,n){Promise.resolve().then(n.bind(n,1404))},7138:function(e,t,n){"use strict";n.d(t,{default:function(){return r.a}});var a=n(231),r=n.n(a)},5162:function(e,t,n){"use strict";n.d(t,{o:function(){return l}});var a=n(4379),r=n.n(a);function l(e){let{icon:t,title:n}=e;r().mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=r().stopTimer,e.onmouseleave=r().resumeTimer}}).fire({icon:t,title:n})}},1317:function(e,t,n){"use strict";n.d(t,{P:function(){return a},n:function(){return r}});let a=async e=>{let{url:t}=e;try{let e=await fetch("".concat("http://localhost:8001/api","/").concat(t),{headers:{"Content-Type":"application/json",Authorization:"".concat("IDsM4RtcaR32024*@>")}});if(!e.ok)return console.error("Error: ".concat(e.status," - ").concat(e.statusText)),null;return await e.json()}catch(e){return console.error("Failed to fetch data:",e),null}},r=async e=>{let{url:t,data:n}=e;try{let e=await fetch("".concat("http://localhost:8001/api","/").concat(t),{headers:{"Content-Type":"application/json",Authorization:"".concat("IDsM4RtcaR32024*@>")},method:"POST",body:JSON.stringify(n)});return await e.json()}catch(e){return null}}},1404:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return p}});var a=n(7437),r=n(2265),l=n(1317),i=n(998),s=n(5162);n(4590);var o=n(8064),c=(0,o.$)("c3e6f0bcc6b1bede4e37f25fbc2b595c678cbbc4"),d=n(7138),u=(0,o.$)("0f0a2e0478744b5ec06ecbcfd3260e26c15a5f10"),m=n(5100),h=n(7818),x=n(1968);let b=(0,h.default)(()=>Promise.resolve().then(n.bind(n,5100)).then(e=>e.PDFViewer),{loadableGenerated:{webpack:()=>[null]},ssr:!1,loading:()=>(0,a.jsx)("p",{children:"Loading..."})}),f=m.StyleSheet.create({page:{padding:30},header:{flexDirection:"row",justifyContent:"space-between",marginBottom:20},companyInfo:{width:"40%"},customerInfo:{textAlign:"right",width:"60%"},logo:{width:100,height:100},title:{fontSize:24,marginBottom:10,textAlign:"center"},item:{flexDirection:"row",borderBottomWidth:1,borderBottomColor:"#ddd",marginBottom:5,paddingBottom:5},itemName:{width:"70%"},diskonItem:{width:"40%",textAlign:"center"},qty:{width:"30%",textAlign:"center"},itemPrice:{textAlign:"right",width:"60%"},total:{fontSize:18,marginTop:20,textAlign:"right"}});var j=e=>{let{data:t}=e;return(0,a.jsx)("div",{children:(0,a.jsx)("dialog",{id:"modal-pos-print",className:"modal",children:(0,a.jsxs)("div",{className:"modal-box w-8/12 max-w-2xl",children:[(0,a.jsx)("form",{method:"dialog",children:(0,a.jsx)("button",{className:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2",children:"✕"})}),(0,a.jsx)(b,{className:"w-full h-80",children:(0,a.jsx)(m.Document,{children:(0,a.jsxs)(m.Page,{style:f.page,children:[(0,a.jsx)(m.View,{style:f.header,children:(0,a.jsxs)(m.View,{style:f.companyInfo,children:[(0,a.jsxs)(m.Text,{children:["Billing No: ",null==t?void 0:t.groupTransaksiId]}),(0,a.jsxs)(m.Text,{children:["Date: ",(null==t?void 0:t.groupTransaksiId)&&(0,x.WU)(new Date(null==t?void 0:t.createdAt),"dd/MM/yyyy")]}),(0,a.jsx)(m.Text,{children:null==t?void 0:t.namaPelanggan}),(0,a.jsx)(m.Text,{children:null==t?void 0:t.hpPelanggan})]})}),(0,a.jsx)(m.Text,{style:f.title,children:"Billing Obat"}),(0,a.jsxs)(m.View,{style:f.item,children:[(0,a.jsx)(m.Text,{style:f.itemName,children:"Item"}),(0,a.jsx)(m.Text,{style:f.diskonItem,children:"Diskon Item"}),(0,a.jsx)(m.Text,{style:f.qty,children:"Qty"}),(0,a.jsx)(m.Text,{style:f.itemPrice,children:"Sub Total"})]}),null==t?void 0:t.transaksiPosDetail.map(e=>(0,a.jsxs)(m.View,{style:f.item,children:[(0,a.jsxs)(m.Text,{style:f.itemName,children:[e.namaBarang," ",e.hargaJual]}),(0,a.jsxs)(m.Text,{style:f.diskonItem,children:[e.diskonFromBo," "]}),(0,a.jsxs)(m.Text,{style:f.qty,children:["@",e.qty," "]}),(0,a.jsx)(m.Text,{style:f.itemPrice,children:new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(Number(e.hargaSetelahDiskon)*Number(e.qty))})]},e.id)),(0,a.jsxs)(m.Text,{style:f.total,children:["Sub Total: ",new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(Number(null==t?void 0:t.subTotal))]}),(0,a.jsxs)(m.Text,{style:f.total,children:["Pajak: ",new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(Number(null==t?void 0:t.pajak))]}),(0,a.jsxs)(m.Text,{style:f.total,children:["Diskon: ",new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(Number(null==t?void 0:t.diskonInvoice))]}),(0,a.jsxs)(m.Text,{style:f.total,children:["Biaya Lain: ",new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(Number(null==t?void 0:t.biayaLainnya))]}),(0,a.jsxs)(m.Text,{style:f.total,children:["Total: ",new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(Number(null==t?void 0:t.total))]})]})})})]})})})},p=()=>{let{data:e}=(0,i.useSession)(),[t,n]=(0,r.useState)([]),[o,m]=(0,r.useState)([]),[h,x]=(0,r.useState)(0),[b,f]=(0,r.useState)(0),[p,g]=(0,r.useState)(""),[y,v]=(0,r.useState)(""),[N,w]=(0,r.useState)(""),[k,I]=(0,r.useState)(0),[S,_]=(0,r.useState)(0),[T,D]=(0,r.useState)(0),[P,B]=(0,r.useState)(""),[C,A]=(0,r.useState)(""),[R,O]=(0,r.useState)(""),[F,q]=(0,r.useState)(""),[M,Z]=(0,r.useState)(""),[E,H]=(0,r.useState)();(0,r.useEffect)(()=>{(async e=>{n((await (0,l.P)({url:"master-barang?wfid=".concat(e)})).data.data)})(null==e?void 0:e.user.wfid)},[null==e?void 0:e.user]);let L=e=>{if(o.find(t=>t.barang_id===e.barang_id)){let t=o.map(t=>{if(t.barang_id===e.barang_id){var n,a;let r=0;if(null===(n=e.diskon)||void 0===n?void 0:n.percent_disc){let t=Number(e.barang.harga_jual)*(Number(e.diskon.percent_disc)/100);r=Number(e.barang.harga_jual)-t}else r=Number(e.barang.harga_jual)-Number(null===(a=e.diskon)||void 0===a?void 0:a.amount_disc);return{...t,qty:t.qty+1,totalHarga:Number(t.qty+1)*r}}return t});m(t),z(t)}else{var t,n,a,r;let l=0;if(null===(t=e.diskon)||void 0===t?void 0:t.percent_disc){let t=Number(e.barang.harga_jual)*(Number(e.diskon.percent_disc)/100);l=Number(e.barang.harga_jual)-t}else l=Number(e.barang.harga_jual)-Number(null===(r=e.diskon)||void 0===r?void 0:r.amount_disc);let i={barang_id:e.barang_id,nama_barang:e.barang.nama_barang,harga_jual:e.barang.harga_jual,qty:1,totalHarga:l,diskonFromBo:(null===(n=e.diskon)||void 0===n?void 0:n.amount_disc)?e.diskon.amount_disc:Number(e.barang.harga_jual)*(Number(null===(a=e.diskon)||void 0===a?void 0:a.percent_disc)/100)},s=[...o,i];m([...o,i]),z(s)}},z=e=>{let t=e.reduce((e,t)=>e+t.totalHarga,0);x(t),f(t)},V=e=>{g(e),$(Number(y),Number(e),Number(N))},U=e=>{v(e),$(Number(e),Number(p),Number(N))},W=e=>{w(e),$(Number(y),Number(p),Number(e))},$=(e,t,n)=>{let a=0,r=h,l=e/100*r;D(l),r=h+l,"percent"===M?_(a=n/100*r):(a=n,_(n)),f(r-a+t)},J=()=>{var e;if(!F){(0,s.o)({icon:"error",title:"Silahkan isi nama pelanggan!"});return}(null===(e=document)||void 0===e?void 0:e.getElementById("modal-pos")).showModal(),B(""),I(0)},K=async t=>{t.preventDefault();let n=t.target.bayar.value,a=new Date().valueOf().toString(),r={barang:null==o?void 0:o.map(e=>({barang_id:e.barang_id,qty:e.qty})),wfid:null==e?void 0:e.user.wfid};if(n<b){(0,s.o)({icon:"error",title:"Pembayaran tidak boleh kurang"});return}let i=await c(o,{namaPelanggan:F,emailPelanggan:C,groupTransaksiId:a,hpPelanggan:R,diskonInvoice:S.toString(),pajak:T.toString(),biayaLainnya:null!=p?p:"0",subTotal:h.toString(),total:b.toString(),totalBayar:n},null==e?void 0:e.user.idFasyankes);if(i.status){var d;let e=await (0,l.n)({url:"decrease-stock",data:r});if(!e.status){(0,s.o)({icon:"error",title:e.message});return}(0,s.o)({icon:"success",title:i.message}),(null===(d=document)||void 0===d?void 0:d.getElementById("modal-pos")).close(),m([]),z([]),g(""),A(""),O(""),q(""),H((await u(a)).data),setTimeout(()=>{var e;(null===(e=document)||void 0===e?void 0:e.getElementById("modal-pos-print")).show()},2e3)}else(0,s.o)({icon:"error",title:i.message})},Q=e=>{let t=o.filter(t=>t.barang_id!==e);z(t),m(t)},Y=e=>{B(e),I(Number(e)-b)};return(0,a.jsxs)("div",{className:"flex gap-2 flex-col p-2",children:[(0,a.jsx)(d.default,{href:"/klinik",children:(0,a.jsxs)("button",{className:"btn btn-sm btn-primary",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor",className:"size-4",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M12.5 9.75A2.75 2.75 0 0 0 9.75 7H4.56l2.22 2.22a.75.75 0 1 1-1.06 1.06l-3.5-3.5a.75.75 0 0 1 0-1.06l3.5-3.5a.75.75 0 0 1 1.06 1.06L4.56 5.5h5.19a4.25 4.25 0 0 1 0 8.5h-1a.75.75 0 0 1 0-1.5h1a2.75 2.75 0 0 0 2.75-2.75Z",clipRule:"evenodd"})}),"Kembali"]})}),(0,a.jsxs)("div",{role:"alert",className:"alert alert-info",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",className:"h-6 w-6 shrink-0 stroke-current",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,a.jsx)("span",{children:"POS Penjualan Obat"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("div",{className:"w-2/3 h-full flex flex-col min-h-screen p-2",children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"table",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Produk"}),(0,a.jsx)("th",{children:"Harga"}),(0,a.jsx)("td",{children:"Diskon"}),(0,a.jsx)("th",{})]})}),(0,a.jsx)("tbody",{children:null==t?void 0:t.map(e=>{var t,n,r;return(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:(0,a.jsx)("div",{className:"flex items-center gap-3",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-bold",children:(null==e?void 0:null===(t=e.barang)||void 0===t?void 0:t.nama_barang)||"Unknown Name"}),(0,a.jsxs)("div",{className:"text-sm opacity-50",children:["Stok: ",null!==(r=null==e?void 0:e.stok)&&void 0!==r?r:"N/A"]})]})})}),(0,a.jsx)("td",{children:(null==e?void 0:null===(n=e.barang)||void 0===n?void 0:n.harga_jual)?new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(Number(e.barang.harga_jual)):"Unknown Price"}),(0,a.jsx)("td",{children:(null==e?void 0:e.diskon)?"Percentage"===e.diskon.type?"".concat(e.diskon.percent_disc,"%"):new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(Number(e.diskon.amount_disc)):"No Discount"}),(0,a.jsx)("th",{children:(0,a.jsx)("button",{onClick:()=>L(e),className:"btn btn-primary",children:"Tambah"})})]},null==e?void 0:e.barang_id)})})]})})}),(0,a.jsx)("div",{className:"w-1/3",children:(0,a.jsxs)("div",{className:"flex flex-col bg-base-200 min-h-screen p-2 gap-2",children:[(0,a.jsx)("p",{className:"text-xl font-medium",children:"Biodata Pasien"}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("p",{className:"font-medium label-text",children:"Nama"}),(0,a.jsx)("input",{type:"text",value:F,onChange:e=>q(e.target.value),className:"input input-bordered w-full max-w-xs"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("p",{className:"font-medium label-text",children:"No HP"}),(0,a.jsx)("input",{type:"number",value:R,onChange:e=>O(e.target.value),className:"input input-bordered w-full max-w-xs"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("p",{className:"font-medium label-text",children:"Email"}),(0,a.jsx)("input",{type:"email",value:C,onChange:e=>A(e.target.value),className:"input input-bordered w-full max-w-xs"})]}),(0,a.jsx)("div",{className:"divider"}),(0,a.jsxs)("table",{className:"table",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Produk"}),(0,a.jsx)("th",{children:"QTY"}),(0,a.jsx)("th",{children:"Total"}),(0,a.jsx)("th",{})]})}),(0,a.jsx)("tbody",{children:null==o?void 0:o.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:(0,a.jsx)("div",{children:(0,a.jsx)("div",{className:"font-bold",children:e.nama_barang})})}),(0,a.jsx)("td",{children:e.qty}),(0,a.jsx)("td",{children:new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(e.totalHarga)}),(0,a.jsx)("td",{children:(0,a.jsx)("button",{className:"btn btn-circle btn-error",onClick:()=>Q(e.barang_id),children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor",className:"size-4",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M5 3.25V4H2.75a.75.75 0 0 0 0 1.5h.3l.815 8.15A1.5 1.5 0 0 0 5.357 15h5.285a1.5 1.5 0 0 0 1.493-1.35l.815-8.15h.3a.75.75 0 0 0 0-1.5H11v-.75A2.25 2.25 0 0 0 8.75 1h-1.5A2.25 2.25 0 0 0 5 3.25Zm2.25-.75a.75.75 0 0 0-.75.75V4h3v-.75a.75.75 0 0 0-.75-.75h-1.5ZM6.05 6a.75.75 0 0 1 .787.713l.275 5.5a.75.75 0 0 1-1.498.075l-.275-5.5A.75.75 0 0 1 6.05 6Zm3.9 0a.75.75 0 0 1 .712.787l-.275 5.5a.75.75 0 0 1-1.498-.075l.275-5.5a.75.75 0 0 1 .786-.711Z",clipRule:"evenodd"})})})})]},e.barang_id))})]}),(0,a.jsx)("div",{className:"divider"}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("p",{className:"text-xl font-medium",children:"Rincian Pembayaran"}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("p",{className:"font-medium label-text",children:"Sub Total"}),(0,a.jsx)("input",{type:"text",value:h,readOnly:!0,className:"input input-bordered w-full max-w-xs"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("p",{className:"font-medium label-text",children:"Pajak %"}),(0,a.jsx)("input",{type:"number",max:100,value:y,onChange:e=>U(e.target.value),className:"input input-bordered w-full max-w-xs"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("p",{className:"font-medium label-text",children:"Diskon"}),(0,a.jsx)("p",{children:"%"}),(0,a.jsx)("input",{type:"radio",className:"radio radio-primary",onChange:e=>Z(e.target.value),name:"diskon",value:"percent"}),(0,a.jsx)("p",{children:"Rp."}),(0,a.jsx)("input",{type:"radio",className:"radio radio-primary",onChange:e=>Z(e.target.value),name:"diskon",value:"rp"}),(0,a.jsx)("input",{type:"text",value:N,onChange:e=>W(e.target.value),className:"input input-bordered w-full max-w-xs"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("p",{className:"font-medium label-text",children:"Biaya Lainnya"}),(0,a.jsx)("input",{type:"number",value:p,onChange:e=>V(e.target.value),className:"input input-bordered w-full max-w-xs"})]}),(0,a.jsx)("div",{children:(0,a.jsxs)("button",{onClick:()=>J(),className:"btn btn-info btn-block",children:["BAYAR"," ",new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(Number(b))]})})]})]})})]}),(0,a.jsx)("dialog",{id:"modal-pos",className:"modal",children:(0,a.jsxs)("div",{className:"modal-box w-4/12 max-w-2xl",children:[(0,a.jsx)("form",{method:"dialog",children:(0,a.jsx)("button",{className:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2",children:"✕"})}),(0,a.jsxs)("form",{className:"flex flex-col gap-2",onSubmit:K,children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("p",{className:"w-1/3",children:"Total"}),(0,a.jsx)("input",{type:"number",readOnly:!0,value:b.toString(),className:"input input-primary"})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("p",{className:"w-1/3",children:"Bayar"}),(0,a.jsx)("input",{type:"number",required:!0,value:P,name:"bayar",onChange:e=>Y(e.target.value),autoFocus:!0,className:"input input-primary"})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("p",{className:"w-1/3",children:"Kembali"}),(0,a.jsx)("input",{type:"number",value:k,readOnly:!0,className:"input input-primary"})]}),(null==e?void 0:e.user.role)!=="admin"&&(null==e?void 0:e.user.role)!=="tester"&&(0,a.jsx)("button",{className:"btn btn-info",children:"SUBMIT"})]})]})}),(0,a.jsx)(j,{data:E})]})}},8362:function(e,t,n){"use strict";function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}n.d(t,{Z:function(){return a}})},2988:function(e,t,n){"use strict";function a(){return(a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)({}).hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(null,arguments)}n.d(t,{Z:function(){return a}})},3950:function(e,t,n){"use strict";function a(e,t){if(null==e)return{};var n={};for(var a in e)if(({}).hasOwnProperty.call(e,a)){if(t.includes(a))continue;n[a]=e[a]}return n}n.d(t,{Z:function(){return a}})},8620:function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n.d(t,{Z:function(){return a}})},5352:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});var a=n(8362);function r(e,t){if(e){if("string"==typeof e)return(0,a.Z)(e,t);var n=({}).toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?(0,a.Z)(e,t):void 0}}}},function(e){e.O(0,[9461,249,7448,7282,231,1968,998,2353,2971,7023,1744],function(){return e(e.s=867)}),_N_E=e.O()}]);