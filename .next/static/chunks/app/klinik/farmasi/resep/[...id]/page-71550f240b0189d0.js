(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5671],{2480:function(){},9532:function(t,a,e){Promise.resolve().then(e.t.bind(e,231,23)),Promise.resolve().then(e.bind(e,3218))},6463:function(t,a,e){"use strict";var n=e(1169);e.o(n,"useRouter")&&e.d(a,{useRouter:function(){return n.useRouter}})},6781:function(t,a,e){"use strict";e.d(a,{Z:function(){return h}});var n=e(2988),i=e(2265),r=e(3139),l=e(7792),s=e(2475),o=e(2897),u=e(373),d=e(135),c=e(4390),m=["defaultOptions","cacheOptions","loadOptions","options","isLoading","onInputChange","filterOption"];e(4887),e(2658);var h=(0,i.forwardRef)(function(t,a){var e,h,b,p,f,g,x,j,v,w,y,N,k,S,C,I,T,O,P,A,B,Z,_,R,D,L,E,V,z,M,F,J,q,G,K,H,U,W,X,Y,$,Q,tt,ta,te,tn,ti,tr,tl,ts,to,tu=(h=void 0!==(e=t.defaultOptions)&&e,p=void 0!==(b=t.cacheOptions)&&b,f=t.loadOptions,t.options,g=t.isLoading,x=t.onInputChange,j=t.filterOption,w=(v=(0,d.Z)(t,m)).inputValue,y=(0,i.useRef)(void 0),N=(0,i.useRef)(!1),k=(0,i.useState)(Array.isArray(h)?h:void 0),C=(S=(0,u.Z)(k,2))[0],I=S[1],T=(0,i.useState)(void 0!==w?w:""),P=(O=(0,u.Z)(T,2))[0],A=O[1],B=(0,i.useState)(!0===h),_=(Z=(0,u.Z)(B,2))[0],R=Z[1],D=(0,i.useState)(void 0),E=(L=(0,u.Z)(D,2))[0],V=L[1],z=(0,i.useState)([]),F=(M=(0,u.Z)(z,2))[0],J=M[1],q=(0,i.useState)(!1),K=(G=(0,u.Z)(q,2))[0],H=G[1],U=(0,i.useState)({}),X=(W=(0,u.Z)(U,2))[0],Y=W[1],$=(0,i.useState)(void 0),tt=(Q=(0,u.Z)($,2))[0],ta=Q[1],te=(0,i.useState)(void 0),ti=(tn=(0,u.Z)(te,2))[0],tr=tn[1],p!==ti&&(Y({}),tr(p)),h!==tt&&(I(Array.isArray(h)?h:void 0),ta(h)),(0,i.useEffect)(function(){return N.current=!0,function(){N.current=!1}},[]),tl=(0,i.useCallback)(function(t,a){if(!f)return a();var e=f(t,a);e&&"function"==typeof e.then&&e.then(a,function(){return a()})},[f]),(0,i.useEffect)(function(){!0===h&&tl(P,function(t){N.current&&(I(t||[]),R(!!y.current))})},[]),ts=(0,i.useCallback)(function(t,a){var e=(0,c.L)(t,a,x);if(!e){y.current=void 0,A(""),V(""),J([]),R(!1),H(!1);return}if(p&&X[e])A(e),V(e),J(X[e]),R(!1),H(!1);else{var n=y.current={};A(e),R(!0),H(!E),tl(e,function(t){N&&n===y.current&&(y.current=void 0,R(!1),V(e),J(t||[]),H(!1),Y(t?(0,o.Z)((0,o.Z)({},X),{},(0,s.Z)({},e,t)):X))})}},[p,tl,E,X,x]),to=K?[]:P&&E?F:C||[],(0,o.Z)((0,o.Z)({},v),{},{options:to,isLoading:_||void 0!==g&&g,onInputChange:ts,filterOption:void 0===j?null:j})),td=(0,l.u)(tu);return i.createElement(r.S,(0,n.Z)({ref:a},td))})},5162:function(t,a,e){"use strict";e.d(a,{o:function(){return r}});var n=e(4379),i=e.n(n);function r(t){let{icon:a,title:e}=t;i().mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3,timerProgressBar:!0,didOpen:t=>{t.onmouseenter=i().stopTimer,t.onmouseleave=i().resumeTimer}}).fire({icon:a,title:e})}},3218:function(t,a,e){"use strict";e.d(a,{default:function(){return p}});var n=e(7437),i=e(2265),r=e(6781),l=e(1317),s=e(5162);e(4590);var o=(0,e(8064).$)("2c649e101c1182e70ea6174575fc5fe9faab832b"),u=e(5100);let d=(0,e(7818).default)(()=>Promise.resolve().then(e.bind(e,5100)).then(t=>t.PDFViewer),{loadableGenerated:{webpack:()=>[null]},ssr:!1,loading:()=>(0,n.jsx)("p",{children:"Loading..."})});var c=t=>{let{billFarmasi:a,pasien:e}=t,i=null==a?void 0:a.data.billPasienDetail.reduce((t,a)=>Number(t)+Number(a.subTotal),0),r=u.StyleSheet.create({page:{padding:30},header:{flexDirection:"row",justifyContent:"space-between",marginBottom:20},companyInfo:{width:"40%"},customerInfo:{textAlign:"right",width:"60%"},logo:{width:100,height:100},title:{fontSize:24,marginBottom:10,textAlign:"center"},item:{flexDirection:"row",borderBottomWidth:1,borderBottomColor:"#ddd",marginBottom:5,paddingBottom:5},itemName:{width:"70%"},itemPrice:{textAlign:"right",width:"30%"},total:{fontSize:18,marginTop:20}});return(0,n.jsx)("dialog",{id:"modal-print-bill-farmasi",className:"modal",children:(0,n.jsxs)("div",{className:"modal-box w-8/12 max-w-2xl",children:[(0,n.jsx)("form",{method:"dialog",children:(0,n.jsx)("button",{className:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2",children:"âœ•"})}),(0,n.jsx)(d,{className:"w-full h-80",children:(0,n.jsx)(u.Document,{children:(0,n.jsxs)(u.Page,{style:r.page,children:[(0,n.jsx)(u.Text,{style:r.title,children:"Invoice Obat"}),(0,n.jsxs)(u.View,{style:r.item,children:[(0,n.jsx)(u.Text,{style:r.itemName,children:"Item"}),(0,n.jsx)(u.Text,{style:r.itemPrice,children:"Sub Total"})]}),null==a?void 0:a.data.billPasienDetail.map(t=>(0,n.jsxs)(u.View,{style:r.item,children:[(0,n.jsxs)(u.Text,{style:r.itemName,children:[t.deskripsi," ",t.jumlah,"@",t.harga]}),(0,n.jsx)(u.Text,{style:r.itemPrice,children:new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(Number(t.subTotal))})]},t.id)),(0,n.jsxs)(u.Text,{style:r.total,children:["Total: ",new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(Number(i))]})]})})})]})})},m=e(6463),h=e(4379),b=e.n(h),p=t=>{let{data:a,session:e,soap:u,pendaftaranId:d,pasien:h}=t,[p,f]=(0,i.useState)(null),[g,x]=(0,i.useState)({}),[j,v]=(0,i.useState)(!1),[w,y]=(0,i.useState)(!1),[N,k]=(0,i.useState)(),S=(0,i.useId)(),C=(0,m.useRouter)();(0,i.useEffect)(()=>{a&&f([...a])},[a,j]);let I=async t=>t.length>=2?(await (0,l.P)({url:"master-barang?wfid=".concat(null==e?void 0:e.user.wfid,"&search=").concat(t)})).data.data.map(t=>({value:t.barang_id,label:"".concat(t.barang.nama_barang," (").concat(t.barang.satuan,")"),satuan:t.barang.satuan,harga_jual:t.barang.harga_jual,stok:t.stok})):(await (0,l.P)({url:"master-barang?wfid=".concat(null==e?void 0:e.user.wfid)})).data.data.map(t=>({value:t.barang_id,label:"".concat(t.barang.nama_barang," (").concat(t.barang.satuan,")"),satuan:t.barang.satuan,harga_jual:t.barang.harga_jual,stok:t.stok})),T=t=>{t?(x({namaObat:t.label,obatId:t.value,satuan:t.satuan,harga_jual:t.harga_jual,stok:t.stok}),y(!0)):y(!1)},O=()=>{let t={id:Math.random(),namaObat:g.namaObat,obatId:g.obatId,satuan:g.satuan,jumlah:0,signa1:"",signa2:"",aturanPakai:"",waktu:"",catatan:"",hargaJual:g.harga_jual,sOAPId:Number(u.id),createdAt:new Date,updatedAt:new Date,stok:g.stok};p?f([...p,t]):f([t])},P=t=>{p&&f([...p.filter(a=>a.id!==t)])},A=async()=>{v(!j);let t=null==p?void 0:p.map(t=>({...t,total:Number(t.hargaJual)*Number(t.jumlah),pendaftaranId:d})),a={barang:null==p?void 0:p.map(t=>({barang_id:t.obatId,nama_obat:t.namaObat,qty:t.jumlah})),wfid:null==e?void 0:e.user.wfid};if((await b().fire({title:"Yakin?",text:"Apakah anda yakin ingin menyimpan transaksi ini?",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Iya",cancelButtonText:"Tidak"})).isConfirmed)try{let e=await (0,l.n)({url:"decrease-stock",data:a});if(!e.status){(0,s.o)({icon:"error",title:e.message});return}if(!(await fetch("/api/resep/add?idsoap=".concat(u.id,"&idpendaftaran=").concat(d),{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}})).ok){(0,s.o)({icon:"error",title:"Gagal simpan data!"});return}(0,s.o)({icon:"success",title:"Berhasil!"}),C.refresh()}catch(t){console.log(t),(0,s.o)({icon:"error",title:"string"==typeof t.message?t.message:"Terjadi kesalahan!"})}},B=(t,a,e)=>{if(t&&p){let n=null==p?void 0:p.findIndex(t=>t.id===e);"jumlah"===a?p[n].jumlah=Number(t):"signa1"===a?p[n].signa1=t:"signa2"===a?p[n].signa2=t:"aturanPakai"===a?p[n].aturanPakai=t:"waktu"===a?p[n].waktu=t:p[n].catatan=t}},Z=async()=>{let t=await o(d);if(t.status){var a;(0,s.o)({icon:"success",title:"Berhasil!"}),k(t),await new Promise(t=>setTimeout(t,2e3)),(null===(a=document)||void 0===a?void 0:a.getElementById("modal-print-bill-farmasi")).showModal()}else(0,s.o)({icon:"error",title:"Gagal ambil data!"})};return(0,n.jsxs)("div",{className:"flex flex-col",children:[(null==e?void 0:e.user.role)!=="admin"&&(0,n.jsxs)("table",{className:"table table-sm table-zebra mb-8",children:[(0,n.jsx)("thead",{className:"bg-base-200",children:(0,n.jsx)("tr",{children:(0,n.jsx)("th",{colSpan:2,children:"Tambah Obat Baru"})})}),(0,n.jsx)("tbody",{children:(0,n.jsx)("tr",{className:"bg-info",children:(0,n.jsx)("td",{children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)(r.Z,{className:"select-info w-full",required:!0,isClearable:!0,name:"obat",loadOptions:t=>new Promise(a=>{setTimeout(()=>{a(I(t))},1e3)}),defaultOptions:!0,onChange:t=>T(t),placeholder:"Cari obat",instanceId:S}),(null==e?void 0:e.user.role)!=="tester"&&(null==e?void 0:e.user.role)!=="admin"&&(0,n.jsx)("div",{className:"tooltip tooltip-left w-20","data-tip":"Tambah Resep",children:(0,n.jsx)("button",{className:"btn btn-sm btn-circle btn-primary",disabled:!w,onClick:()=>O(),children:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor",className:"size-4",children:(0,n.jsx)("path",{d:"M8.75 3.75a.75.75 0 0 0-1.5 0v3.5h-3.5a.75.75 0 0 0 0 1.5h3.5v3.5a.75.75 0 0 0 1.5 0v-3.5h3.5a.75.75 0 0 0 0-1.5h-3.5v-3.5Z"})})})})]})})})})]}),(0,n.jsxs)("table",{className:"table table-sm table-zebra",children:[(0,n.jsx)("thead",{className:"bg-base-200",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"No"}),(0,n.jsx)("th",{children:"Nama Obat"}),(0,n.jsx)("th",{children:"Jumlah"}),(0,n.jsx)("th",{children:"Satuan"}),(0,n.jsx)("th",{children:"Signa 1"}),(0,n.jsx)("th",{}),(0,n.jsx)("th",{children:"Signa 2"}),(0,n.jsx)("th",{children:"Aturan"}),(0,n.jsx)("th",{children:"Waktu"}),(0,n.jsx)("th",{children:"Catatan"}),(null==e?void 0:e.user.role)!=="admin"&&(null==e?void 0:e.user.role)!=="tester"&&(0,n.jsx)("th",{children:"Aksi"})]})}),(0,n.jsx)("tbody",{children:null==p?void 0:p.map((t,a)=>{var i,r,l,s,o,u,d,c;return(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:a+1}),(0,n.jsxs)("td",{children:[(0,n.jsx)("div",{className:"font-bold",children:(null==t?void 0:null===(i=t.namaObat)||void 0===i?void 0:i.toString())||"Unknown Obat"}),(0,n.jsxs)("div",{className:"text-sm opacity-50",children:["Stok: ",null!==(c=null==t?void 0:t.stok)&&void 0!==c?c:"N/A"]})]}),(0,n.jsx)("td",{children:(0,n.jsx)("input",{type:"text",onChange:a=>B(a.target.value,"jumlah",t.id),className:"input input-sm input-primary w-14",defaultValue:null===(r=t.jumlah)||void 0===r?void 0:r.toString()})}),(0,n.jsx)("td",{children:t.satuan}),(0,n.jsx)("td",{children:(0,n.jsx)("input",{type:"text",onChange:a=>B(a.target.value,"signa1",t.id),className:"input input-sm input-primary w-14",defaultValue:null===(l=t.signa1)||void 0===l?void 0:l.toString()})}),(0,n.jsx)("td",{children:"X"}),(0,n.jsx)("td",{children:(0,n.jsx)("input",{type:"text",onChange:a=>B(a.target.value,"signa2",t.id),className:"input input-sm input-primary w-14",defaultValue:null===(s=t.signa2)||void 0===s?void 0:s.toString()})}),(0,n.jsx)("td",{children:(0,n.jsx)("input",{type:"text",onChange:a=>B(a.target.value,"aturanPakai",t.id),className:"input input-sm input-primary w-40",defaultValue:null===(o=t.aturanPakai)||void 0===o?void 0:o.toString()})}),(0,n.jsx)("td",{children:(0,n.jsx)("input",{type:"text",onChange:a=>B(a.target.value,"waktu",t.id),className:"input input-sm input-primary w-32",defaultValue:null===(u=t.waktu)||void 0===u?void 0:u.toString()})}),(0,n.jsx)("td",{children:(0,n.jsx)("input",{type:"text",onChange:a=>B(a.target.value,"catatan",t.id),className:"input input-sm input-primary w-32",defaultValue:null===(d=t.catatan)||void 0===d?void 0:d.toString()})}),(null==e?void 0:e.user.role)!=="admin"&&(null==e?void 0:e.user.role)!=="tester"&&(0,n.jsx)("td",{className:"tooltip tooltip-left","data-tip":"Hapus Resep",children:(0,n.jsx)("button",{onClick:()=>P(Number(t.id)),className:"btn btn-xs btn-error btn-circle ",children:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor",className:"size-4",children:(0,n.jsx)("path",{d:"M5.28 4.22a.75.75 0 0 0-1.06 1.06L6.94 8l-2.72 2.72a.75.75 0 1 0 1.06 1.06L8 9.06l2.72 2.72a.75.75 0 1 0 1.06-1.06L9.06 8l2.72-2.72a.75.75 0 0 0-1.06-1.06L8 6.94 5.28 4.22Z"})})})})]},t.obatId)})})]}),u.isBillingFarmasi?(0,n.jsxs)("div",{className:"flex flex-col gap-3 mt-5",children:[(0,n.jsx)("button",{className:"btn btn-error btn-sm",children:"SUDAH TRANSAKSI"}),(0,n.jsx)("button",{className:"btn btn-info btn-sm",onClick:()=>Z(),children:"CETAK BILL"})]}):(null==e?void 0:e.user.role)!=="admin"&&(null==e?void 0:e.user.role)!=="tester"&&(0,n.jsx)("button",{onClick:()=>A(),className:"btn btn-primary btn-sm mt-10",children:"SIMPAN TRANSAKSI"}),(0,n.jsx)(c,{billFarmasi:N,pasien:h})]})}},1317:function(t,a,e){"use strict";e.d(a,{P:function(){return n},n:function(){return i}});let n=async t=>{let{url:a}=t;try{let t=await fetch("".concat("http://localhost:8001/api","/").concat(a),{headers:{"Content-Type":"application/json",Authorization:"".concat("IDsM4RtcaR32024*@>")}});if(!t.ok)return console.error("Error: ".concat(t.status," - ").concat(t.statusText)),null;return await t.json()}catch(t){return console.error("Failed to fetch data:",t),null}},i=async t=>{let{url:a,data:e}=t;try{let t=await fetch("".concat("http://localhost:8001/api","/").concat(a),{headers:{"Content-Type":"application/json",Authorization:"".concat("IDsM4RtcaR32024*@>")},method:"POST",body:JSON.stringify(e)});return await t.json()}catch(t){return null}}}},function(t){t.O(0,[9461,249,7448,7282,231,5670,2353,2971,7023,1744],function(){return t(t.s=9532)}),_N_E=t.O()}]);