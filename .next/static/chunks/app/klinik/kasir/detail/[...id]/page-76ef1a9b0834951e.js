(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9684],{42480:function(){},14475:function(e,t,n){Promise.resolve().then(n.bind(n,60077))},57818:function(e,t,n){"use strict";n.d(t,{default:function(){return a.a}});var r=n(50551),a=n.n(r)},66648:function(e,t,n){"use strict";n.d(t,{default:function(){return a.a}});var r=n(55601),a=n.n(r)},16463:function(e,t,n){"use strict";var r=n(71169);n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}})},58064:function(e,t,n){"use strict";Object.defineProperty(t,"$",{enumerable:!0,get:function(){return a}});let r=n(74590);function a(e){let{createServerReference:t}=n(6671);return t(e,r.callServer)}},50551:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i}});let r=n(51609);n(57437),n(2265);let a=r._(n(40148));function i(e,t){var n;let r={loading:e=>{let{error:t,isLoading:n,pastDelay:r}=e;return null}};"function"==typeof e&&(r.loader=e);let i={...r,...t};return(0,a.default)({...i,modules:null==(n=i.loadableGenerated)?void 0:n.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},55601:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{default:function(){return s},getImageProps:function(){return o}});let r=n(51609),a=n(80497),i=n(38173),l=r._(n(21241));function o(e){let{props:t}=(0,a.getImgProps)(e,{defaultLoader:l.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!1}});for(let[e,n]of Object.entries(t))void 0===n&&delete t[e];return{props:t}}let s=i.Image},10912:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return a}});let r=n(55592);function a(e){let{reason:t,children:n}=e;if("undefined"==typeof window)throw new r.BailoutToCSRError(t);return n}},40148:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return c}});let r=n(57437),a=n(2265),i=n(10912),l=n(61481);function o(e){return{default:e&&"default"in e?e.default:e}}let s={loader:()=>Promise.resolve(o(()=>null)),loading:null,ssr:!0},c=function(e){let t={...s,...e},n=(0,a.lazy)(()=>t.loader().then(o)),c=t.loading;function u(e){let o=c?(0,r.jsx)(c,{isLoading:!0,pastDelay:!0,error:null}):null,s=t.ssr?(0,r.jsxs)(r.Fragment,{children:["undefined"==typeof window?(0,r.jsx)(l.PreloadCss,{moduleIds:t.modules}):null,(0,r.jsx)(n,{...e})]}):(0,r.jsx)(i.BailoutToCSR,{reason:"next/dynamic",children:(0,r.jsx)(n,{...e})});return(0,r.jsx)(a.Suspense,{fallback:o,children:s})}return u.displayName="LoadableComponent",u}},61481:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadCss",{enumerable:!0,get:function(){return i}});let r=n(57437),a=n(58512);function i(e){let{moduleIds:t}=e;if("undefined"!=typeof window)return null;let n=(0,a.getExpectedRequestStore)("next/dynamic css"),i=[];if(n.reactLoadableManifest&&t){let e=n.reactLoadableManifest;for(let n of t){if(!e[n])continue;let t=e[n].files.filter(e=>e.endsWith(".css"));i.push(...t)}}return 0===i.length?null:(0,r.jsx)(r.Fragment,{children:i.map(e=>(0,r.jsx)("link",{precedence:"dynamic",rel:"stylesheet",href:n.assetPrefix+"/_next/"+encodeURI(e),as:"style"},e))})}},60291:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RouterContext",{enumerable:!0,get:function(){return r}});let r=n(51609)._(n(2265)).default.createContext(null)},61788:function(e,t,n){"use strict";n.d(t,{c:function(){return r}});let r=e=>{let t=e.trim().split(" ");return 1===t.length?{firstName:t[0],lastName:t[0]}:{firstName:t[0],lastName:t.slice(1).join(" ")}}},75162:function(e,t,n){"use strict";n.d(t,{o:function(){return i}});var r=n(64379),a=n.n(r);function i(e){let{icon:t,title:n}=e;a().mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=a().stopTimer,e.onmouseleave=a().resumeTimer}}).fire({icon:t,title:n})}},73193:function(e,t,n){"use strict";n.d(t,{V:function(){return a},b:function(){return r}});let r=e=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",maximumFractionDigits:0,minimumFractionDigits:0}).format(Number(e)),a=e=>{let t=Number(e.replace(/[^0-9]/g,""));return isNaN(t)?"":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(t)}},60077:function(e,t,n){"use strict";n.d(t,{default:function(){return b}});var r=n(57437),a=n(2265),i=n(75162);n(74590);var l=(0,n(58064).$)("6aabf69796b0d79cb06862e2ed602e024266be51"),o=n(5100);let s=(0,n(57818).default)(()=>Promise.resolve().then(n.bind(n,5100)).then(e=>e.PDFViewer),{loadableGenerated:{webpack:()=>[null]},ssr:!1,loading:()=>(0,r.jsx)("p",{children:"Loading..."})});var c=e=>{let{tagihan:t}=e,n=null==t?void 0:t.billPasienDetail.reduce((e,t)=>Number(e)+Number(t.subTotal),0),a=o.StyleSheet.create({page:{padding:30},header:{flexDirection:"row",justifyContent:"space-between",marginBottom:20},companyInfo:{width:"40%"},customerInfo:{textAlign:"right",width:"60%"},logo:{width:100,height:100},title:{fontSize:24,marginBottom:10,textAlign:"center"},item:{flexDirection:"row",borderBottomWidth:1,borderBottomColor:"#ddd",marginBottom:5,paddingBottom:5},itemName:{width:"70%"},itemPrice:{textAlign:"right",width:"30%"},total:{textAlign:"right",fontSize:18,marginTop:20},metodeBayar:{marginTop:10}});return(0,r.jsx)("dialog",{id:"modal-print-bill-pasien",className:"modal",children:(0,r.jsxs)("div",{className:"modal-box w-8/12 max-w-2xl",children:[(0,r.jsx)("form",{method:"dialog",children:(0,r.jsx)("button",{className:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2",children:"✕"})}),(0,r.jsx)(s,{className:"w-full h-80",children:(0,r.jsx)(o.Document,{children:(0,r.jsxs)(o.Page,{style:a.page,children:[(0,r.jsx)(o.View,{style:a.header}),(0,r.jsx)(o.Text,{style:a.title,children:"Invoice Pasien"}),(0,r.jsxs)(o.View,{style:a.item,children:[(0,r.jsx)(o.Text,{style:a.itemName,children:"Item"}),(0,r.jsx)(o.Text,{style:a.itemPrice,children:"Sub Total"})]}),null==t?void 0:t.billPasienDetail.map(e=>(0,r.jsxs)(o.View,{style:a.item,children:[(0,r.jsxs)(o.Text,{style:a.itemName,children:[e.deskripsi," ",e.jumlah,"@",e.harga]}),(0,r.jsx)(o.Text,{style:a.itemPrice,children:new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(Number(e.subTotal))})]},e.id)),(0,r.jsxs)(o.Text,{style:a.metodeBayar,children:["Metode Pembayaran : ",null==t?void 0:t.pembayaranBill[0].kategoriBayar]}),(0,r.jsxs)(o.Text,{style:a.total,children:["Total:"," ",new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(Number(n))]}),null==t?void 0:t.pembayaranBill.map(e=>(0,r.jsxs)(o.View,{children:[(0,r.jsxs)(o.Text,{style:a.total,children:["Diskon:"," ",new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(Number(e.totalDiskon))]}),(0,r.jsxs)(o.Text,{style:a.total,children:["Pajak:"," ",new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(Number(e.totalPajak))]}),(0,r.jsxs)(o.Text,{style:a.total,children:["Total Bayar:"," ",new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(Number(e.totalBayar))]}),(0,r.jsxs)(o.Text,{style:a.total,children:["Kembalian :"," ",new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(Number(e.kembalian))]})]},e.id)),(0,r.jsxs)(o.Text,{style:a.total,children:["Status: ",null==t?void 0:t.status]})]})})})]})})},u=n(16463),d=n(73193),m=n(66648),f=n(22208),h=n(61788),b=e=>{let{detailBill:t}=e,[n,o]=(0,a.useState)(""),[s,b]=(0,a.useState)(""),[y,p]=(0,a.useState)(0),[x,g]=(0,a.useState)(0),[j,v]=(0,a.useState)(0),[N,w]=(0,a.useState)(0),[P,S]=(0,a.useState)(0),[I,T]=(0,a.useState)(0),[B,D]=(0,a.useState)(),[k,C]=(0,a.useState)(!1),O=(0,u.useRouter)(),[_,R]=(0,a.useState)(null),[E,A]=(0,a.useState)(""),F={0:"QRIS",1:"Virtual Account",2:"Debit",3:"Cash"},[M,L]=(0,a.useState)(!1);(0,a.useEffect)(()=>{let e=e=>{var t;(null===(t=e.data)||void 0===t?void 0:t.success)===!0&&L(!0)};return window.addEventListener("message",e),(async()=>{if(M)try{let n={id:t.id,pendaftaranId:t.pendaftaranId,bayar:y,total:y,totalDiskon:P,totalPajak:I,kembali:j,tglBayar:new Date,kategoriBayar:F[null!=_?_:3]};try{var e;if(!(await fetch("/api/kasir/bayar",{method:"POST",body:JSON.stringify(n)})).ok){(0,i.o)({icon:"error",title:"Gagal simpan data!"});return}let t=null===(e=document)||void 0===e?void 0:e.getElementById("modal-payment");null==t||t.close(),(0,i.o)({icon:"success",title:"Berhasil!"}),o(""),b(""),O.refresh()}catch(e){(0,i.o)({icon:"error",title:e.message}),console.log(e)}}catch(e){console.error(e),(0,i.o)({icon:"error",title:"An error occurred"})}})(),()=>{window.removeEventListener("message",e)}},[M]),(0,a.useEffect)(()=>{g(null==t?void 0:t.billPasienDetail.reduce((e,t)=>Number(e)+Number(t.subTotal),0)),p(null==t?void 0:t.billPasienDetail.reduce((e,t)=>Number(e)+Number(t.subTotal),0))},[t]);let V=e=>{/^\d*$/.test(e)?(o(e),z(Number(e),Number(s))):(o(""),z(0,Number(s)))},Z=e=>{/^\d*$/.test(e)?(b(e),z(Number(n),Number(e))):(b(""),z(Number(n),0))},z=(e,t)=>{let n=e/100*x;S(n);let r=x-n,a=t/100*r;T(a),p(r+a)},G=e=>{let t=e.replace(/[^0-9]/g,"");t?(w(Number(t)),v(Number(t)-y)):(w(0),v(0))},J=async()=>{if(null===_){(0,i.o)({icon:"error",title:"Pilih metode pembayaran!"});return}if(0==_||1==_){var e,n,r,a,l,o,s,c,u,d;let{firstName:m,lastName:f}=(0,h.c)(null===(r=t.Pendaftaran)||void 0===r?void 0:null===(n=r.episodePendaftaran)||void 0===n?void 0:null===(e=n.pasien)||void 0===e?void 0:e.namaPasien);try{let e={orderId:t.id,email:null===(o=t.Pendaftaran)||void 0===o?void 0:null===(l=o.episodePendaftaran)||void 0===l?void 0:null===(a=l.pasien)||void 0===a?void 0:a.email,firstName:m,lastName:f,mobilePhone:null===(u=t.Pendaftaran)||void 0===u?void 0:null===(c=u.episodePendaftaran)||void 0===c?void 0:null===(s=c.pasien)||void 0===s?void 0:s.noHp.replace(/^0/,"+62"),amount:y,description:"Bayar Tagihan Pasien"},n=await fetch("/api/payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!n.ok){(0,i.o)({icon:"error",title:"Payment failed"});return}let r=await n.json();console.log(r),A(r.response.redirecturl);let h=null===(d=document)||void 0===d?void 0:d.getElementById("modal-payment");null==h||h.showModal()}catch(e){console.error(e),(0,i.o)({icon:"error",title:"An error occurred"})}}else if(2==_||3==_){if(0===N)(0,i.o)({icon:"error",title:"Pembayaran harus diisi!"});else if(N<y)(0,i.o)({icon:"error",title:"Pembayaran harus lebih besar/sama dengan total tagihan!"});else{let e={id:t.id,pendaftaranId:t.pendaftaranId,bayar:N,total:y,totalDiskon:P,totalPajak:I,kembali:j,tglBayar:new Date,kategoriBayar:F[null!=_?_:3]};try{if(!(await fetch("/api/kasir/bayar",{method:"POST",body:JSON.stringify(e)})).ok){(0,i.o)({icon:"error",title:"Gagal simpan data!"});return}(0,i.o)({icon:"success",title:"Berhasil!"}),O.refresh()}catch(e){console.log(e),(0,i.o)({icon:"error",title:e.message})}}}},$=async e=>{let t=await l(e);if(t.status){var n;D(t.data),await new Promise(e=>setTimeout(e,2e3)),(null===(n=document)||void 0===n?void 0:n.getElementById("modal-print-bill-pasien")).showModal()}else(0,i.o)({icon:"error",title:t.message})};return(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"table table-sm",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{}),(0,r.jsx)("th",{children:"Deskripsi"}),(0,r.jsx)("th",{children:"Jumlah"}),(0,r.jsx)("th",{children:"Harga"}),(0,r.jsx)("th",{children:"Total"})]})}),(0,r.jsxs)("tbody",{children:[t.billPasienDetail.map((e,t)=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:t+1}),(0,r.jsx)("td",{children:e.deskripsi}),(0,r.jsx)("td",{children:e.jumlah}),(0,r.jsx)("td",{children:(0,d.b)(e.harga)}),(0,r.jsx)("td",{children:(0,d.b)(e.subTotal)})]},e.id)),(0,r.jsxs)("tr",{className:"font-semibold",children:[(0,r.jsx)("td",{colSpan:4,className:"text-right",children:"Sub Total"}),(0,r.jsx)("td",{children:(0,d.b)(x)})]}),(0,r.jsxs)("tr",{className:"font-semibold",children:[(0,r.jsx)("td",{colSpan:4,className:"text-right",children:"Diskon %"}),(0,r.jsx)("td",{children:(0,r.jsx)("input",{type:"text",value:n,maxLength:2,onChange:e=>V(e.target.value),className:"input input-sm input-primary"})})]}),(0,r.jsxs)("tr",{className:"font-semibold",children:[(0,r.jsx)("td",{colSpan:4,className:"text-right",children:"Pajak %"}),(0,r.jsx)("td",{children:(0,r.jsx)("input",{type:"text",maxLength:2,onChange:e=>Z(e.target.value),value:s,className:"input input-sm input-primary"})})]}),(0,r.jsxs)("tr",{className:"font-semibold",children:[(0,r.jsx)("td",{colSpan:4,className:"text-right",children:"Total"}),(0,r.jsx)("td",{children:(0,d.b)(y)})]}),(0,r.jsxs)("tr",{className:"font-semibold",children:[(0,r.jsx)("td",{colSpan:4,className:"text-right",children:"Metode Pembayaran"}),(0,r.jsx)("td",{children:(0,r.jsx)("div",{className:"flex gap-2",children:[{name:"QRIS",icon:"/QR.png"},{name:"Virtual Account",icon:"/bank.png"},{name:"Debit Card",icon:"/debit.png"},{name:"Cash",icon:"/cash.png"}].map((e,t)=>{let n=_===t;return(0,r.jsxs)("div",{onClick:()=>R(t),className:"flex flex-col items-center justify-center w-24 h-24\n                                     } border-2 rounded-lg transition-all duration-300 px-2 ".concat(n?"bg-primary border-primary text-white":"bg-gray-100 border-primary text-black"," hover:shadow-lg hover:scale-105 cursor-pointer"),children:[(0,r.jsx)(m.default,{src:e.icon,alt:e.name,width:100,height:80,className:"".concat("QRIS"===e.name?"w-12 h-6":"w-[30px] h-8"," mb-3 ").concat(n?"filter invert":"")}),(0,r.jsx)("span",{className:"text-[10px] text-center ".concat(n?"text-white":"text-black"),children:e.name})]},t)})})})]}),(2==_||3==_)&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("tr",{className:"font-semibold",children:[(0,r.jsx)("td",{colSpan:4,className:"text-right",children:"Jumlah Pembayaran"}),(0,r.jsx)("td",{children:(0,r.jsx)("input",{type:"text",value:(0,d.b)(N),onFocus:()=>C(!0),onBlur:()=>C(!1),onChange:e=>G(e.target.value),className:"input input-sm input-primary"})})]}),(0,r.jsxs)("tr",{className:"font-semibold",children:[(0,r.jsx)("td",{colSpan:4,className:"text-right",children:"Kembali"}),(0,r.jsx)("td",{children:(0,d.b)(j)})]})]}),(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:5,children:"LUNAS"===t.status?(0,r.jsxs)("div",{className:"flex flex-col gap-3 mt-5",children:[(0,r.jsx)("button",{className:"btn btn-success btn-sm",children:"LUNAS"}),(0,r.jsx)("button",{className:"btn btn-info btn-sm",onClick:()=>$(t.id),children:"CETAK KWITANSI"})]}):(0,r.jsx)("button",{onClick:()=>J(),className:"btn btn-primary btn-sm btn-block",children:"BAYAR"})})})]})]})}),(0,r.jsx)(c,{tagihan:B}),(0,r.jsx)(f.Z,{src:E})]})}},22208:function(e,t,n){"use strict";var r=n(57437),a=n(2265),i=n(64379),l=n.n(i);t.Z=e=>{let{src:t}=e,[n,i]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{document.getElementById("modal-payment");let e=e=>{"Escape"===e.key&&e.preventDefault()};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[]),(0,r.jsx)("dialog",{id:"modal-payment",className:"modal z-0",children:(0,r.jsxs)("div",{className:"modal-box p-10",children:[(0,r.jsx)("button",{className:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2",onClick:()=>{n||(i(!0),l().fire({title:"Batalkan Pembayaran?",target:document.getElementById("modal-payment"),icon:"info",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Tidak",confirmButtonText:"Ya"}).then(e=>{if(e.isConfirmed){let e=document.getElementById("modal-payment");null==e||e.close()}i(!1)}))},children:"✕"}),(0,r.jsx)("div",{className:"w-full",children:(0,r.jsx)("iframe",{src:t,style:{height:"600px"},width:"100%"})})]})})}},48362:function(e,t,n){"use strict";function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}n.d(t,{Z:function(){return r}})},22988:function(e,t,n){"use strict";function r(){return(r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(null,arguments)}n.d(t,{Z:function(){return r}})},23950:function(e,t,n){"use strict";function r(e,t){if(null==e)return{};var n={};for(var r in e)if(({}).hasOwnProperty.call(e,r)){if(t.includes(r))continue;n[r]=e[r]}return n}n.d(t,{Z:function(){return r}})},8620:function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n.d(t,{Z:function(){return r}})},85352:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(48362);function a(e,t){if(e){if("string"==typeof e)return(0,r.Z)(e,t);var n=({}).toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?(0,r.Z)(e,t):void 0}}}},function(e){e.O(0,[9461,249,7448,7282,5457,8173,2971,7023,1744],function(){return e(e.s=14475)}),_N_E=e.O()}]);